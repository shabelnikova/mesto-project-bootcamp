(()=>{"use strict";var e=function(e){e.classList.add("popup_opened"),document.addEventListener("keydown",r)},t=function(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",r)},r=function(e){if("Escape"===e.key){var r=document.querySelector(".popup_opened");t(r)}};function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var o,a=document.querySelector(".elements"),i=document.querySelector("#card-template").content.querySelector(".card"),c=document.querySelector("#photoPopup"),u=c.querySelector(".popup__img"),l=c.querySelector(".popup__img-description"),s=document.querySelector(".profile"),d=s.querySelector(".profile__add-button"),f=s.querySelector(".profile__edit-button"),m=s.querySelector(".profile__image-wrapper"),y=document.forms.formEdit,p=y.querySelector(".form__name"),v=y.querySelector(".form__about"),b=document.forms.formAdd,h=document.forms.formAddAvatar,_=document.forms.deleteCardPermit,S=h.querySelector(".form__avatar-img"),g=b.querySelector(".form__name"),q=b.querySelector(".form__about"),A=s.querySelector(".profile__avatar"),E=s.querySelector(".profile__header"),L=s.querySelector(".profile__description"),C=document.querySelector("#editPopup"),k=document.querySelector("#addPopup"),w=document.querySelector("#avatarEditPopup"),x=function(e){if(Array.isArray(e))return n(e)}(o=document.querySelectorAll(".popup"))||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(o)||function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(o)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),j=document.querySelector("#deleteCardPopup"),O={baseUrl:"https://mesto.nomoreparties.co/v1/wbf-cohort-11",headers:{authorization:"583bab91-7255-47af-95fa-3ce7d6743919","Content-Type":"application/json"}},P=function(e,t){return console.log(),fetch(O.baseUrl+e,t).then((function(e){return function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}(e)}))};var T,I,D,U=function(t,r,n,o,a){var s=i.cloneNode(!0),d=s.querySelector(".card__image"),f=s.querySelector(".card__like-quantity");if(f.textContent=a.length,d.src=r,d.alt=t,d.addEventListener("click",(function(){e(c),u.src=r,u.alt=t,l.textContent=t})),s.querySelector(".card__header").textContent=t,n===T){var m=s.querySelector(".card__delete-symbol");m.innerHTML="<img src=".concat("f7144a3e2eb8b093de83.svg",' alt="Кнопка удаления">'),m.addEventListener("click",(function(){e(j),I=s,D=o}))}var y=s.querySelector(".card__like-symbol");return a.find((function(e){return e._id===T}))&&y.classList.add("active"),y.addEventListener("click",(function(){y.classList.contains("active")?function(e){return P("/cards/likes/".concat(e),{headers:O.headers,method:"DELETE"})}(o).then((function(e){return f.textContent=e.likes.length})).then((function(e){return y.classList.remove("active")})).catch(console.error):function(e){return P("/cards/likes/".concat(e),{headers:O.headers,method:"PUT"})}(o).then((function(e){return f.textContent=e.likes.length})).then((function(e){return y.classList.add("active")})).catch(console.error)})),s};function B(e){return function(e){if(Array.isArray(e))return M(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return M(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?M(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}_.addEventListener("submit",(function(e){var r;e.preventDefault(),(r=D,P("/cards/".concat(r),{headers:O.headers,method:"DELETE"})).then((function(){I.remove(),t(j)})).catch(console.error)}));var N,H=function(e,t,r){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(r.inactiveButtonClass),t.removeAttribute("disabled","")):(t.classList.add(r.inactiveButtonClass),t.setAttribute("disabled",""))};function J(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}Promise.all([P("/users/me",{headers:O.headers}),P("/cards",{headers:O.headers})]).then((function(e){var t,r=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(e){if("string"==typeof e)return J(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?J(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e,2),n=r[0],o=r[1];t=n,A.src=t.avatar,A.alt=t.name,E.textContent=t.name,L.textContent=t.about,T=t._id,o.forEach((function(e){a.append(U(e.name,e.link,e.owner._id,e._id,e.likes))}))})).catch(console.error),N={formSelector:".form",inputSelector:".form__item",submitButtonSelector:".form__button",inactiveButtonClass:"form__button_inactive",inputErrorClass:"form__item_type_error",errorClass:"form__item_error"},B(document.querySelectorAll(N.formSelector)).forEach((function(e){!function(e,t){var r=B(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);H(r,n,t),r.forEach((function(e){e.addEventListener("input",(function(){!function(e,t){var r=document.querySelector(".".concat(e.id,"-error"));e.validity.valid?function(e,t,r){e.classList.remove(r.inputErrorClass),t.textContent=""}(e,r,t):function(e,t,r,n){e.classList.add(n.inputErrorClass),r.textContent=t}(e,e.validationMessage,r,t)}(e,t),H(r,n,t)}))}))}(e,N)}));var $=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Сохранение...";t.textContent=e?n:r};d.addEventListener("click",(function(){e(k)})),f.addEventListener("click",(function(){e(C),p.value=E.textContent,v.value=L.textContent})),m.addEventListener("click",(function(){e(w)})),y.addEventListener("submit",(function(e){var r,n;e.preventDefault(),$(!0,e.submitter),(r=p.value,n=v.value,P("/users/me",{headers:O.headers,method:"PATCH",body:JSON.stringify({name:r,about:n})})).then((function(r){E.textContent=r.name,L.textContent=r.about,e.submitter.classList.add("form__button_inactive"),e.submitter.setAttribute("disabled",""),t(C)})).catch(console.error).finally((function(){return $(!1,e.submitter)}))})),b.addEventListener("submit",(function(e){var r,n;e.preventDefault(),$(!0,e.submitter),(r=g.value,n=q.value,P("/cards",{headers:O.headers,method:"POST",body:JSON.stringify({name:r,link:n})})).then((function(r){a.prepend(U(r.name,r.link,r.owner._id,r._id,r.likes)),e.submitter.classList.add("form__button_inactive"),e.submitter.setAttribute("disabled",""),t(k),b.reset()})).catch(console.error).finally((function(){return $(!1,e.submitter,"Создать")}))})),h.addEventListener("submit",(function(e){var r;e.preventDefault(),$(!0,e.submitter),(r=S.value,P("/users/me/avatar",{headers:O.headers,method:"PATCH",body:JSON.stringify({avatar:r})})).then((function(r){console.log(r),A.src=r.avatar,A.alt=E.textContent,t(w),e.submitter.classList.add("form__button_inactive"),e.submitter.setAttribute("disabled",""),h.reset()})).catch(console.error).finally((function(){return $(!1,e.submitter)}))})),x.forEach((function(e){e.addEventListener("mousedown",(function(r){(r.currentTarget===r.target||r.target.classList.contains("popup__closing"))&&t(e)}))}))})();